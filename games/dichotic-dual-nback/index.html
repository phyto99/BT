<html>

  <head>
    <title>Dichotic Dual N-back</title>
    <meta charset="UTF-8">
    <meta name="description" content="Open Source Dichotic Dual N-back">
    <meta name="keywords" content="DNB, N-back, WM">
    <meta name="author" content="4skinSkywalker">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="favicon.png">

    <script src="js/jquery.min.js"></script>
    <script src="js/chartist.min.js"></script>
    <script src="js/howler.min.js"></script>

    <script src="js/popup.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/functions.js"></script>

    <link rel="stylesheet" href="css/chartist.min.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" media="all and (orientation:portrait)" href="css/portrait.css">
    <link rel="stylesheet" media="all and (orientation:landscape)" href="css/landscape.css">
  </head>

  <body>

    <!-- slide-menu start -->
    <ul id="navigation">

      <!-- settings start -->
      <li class="nav-item">
        <!-- sets the duration of clues -->
        <span class="range-label">Stimulus time </span>
        <span id="set-time-span" class="range-label">4000ms</span>
        <input type="range" class="slider" id="set-time" min="1500" max="15000" step="250" value="4000">
      </li>
      <li class="nav-item">
        <!-- sets the quantity of clues -->
        <span class="range-label">Matching clues </span>
        <span id="set-clues-span" class="range-label">10</span>
        <input type="range" class="slider" id="set-clues" min="5" max="30" step="5" value="10">
      </li>
      <li class="nav-item">
        <!-- sets a level of difficulty -->
        <span class="range-label">N-back level </span>
        <span id="set-level-span" class="range-label">2</span>
        <input type="range" class="slider" id="set-level" min="1" max="9" step="1" value="2">
      </li>
      <li class="nav-item">
        <!-- selects a sound for audio clues -->
        <label for="select-sound">Sounds left</label>
        <select class="option" id="select-sound-left">
          <!-- generated by JS, see initSetting within main.js -->
        </select>
      </li>
      <li class="nav-item">
        <!-- selects a sound for audio clues -->
        <label for="select-sound">Sounds right</label>
        <select class="option" id="select-sound-right">
          <!-- generated by JS, see initSetting within main.js -->
        </select>
      </li>
      <li class="nav-item">
        <!-- do you want feedback? -->
        <span class="range-label">Clue feedback? </span>
        <span id="feedback-span" class="range-label">on</span>
        <input type="range" class="slider" id="feedback" min="0" max="1" step="1" value="1">
      </li>
      <!-- settings end -->

      <!-- a brief description on how to play -->
      <li class="nav-item">
        <p>
          <span style="color: #ffd700">Controls:</span>
          <br> "A" for visual left
          <br> "S" for visual right
          <br> "K" for left audio
          <br> "L" for right audio
          <br> "P" to start/stop
          <br>
          <br>
        </p>
      </li>
    </ul>
    <!-- slide-menu end -->

    <!-- slide-menu invocation button -->
    <input type="checkbox" id="nav-trigger"><label for="nav-trigger"></label>

    <!-- training-field start -->
    <div id="site-wrap">

      <!-- a button that shows stats -->
      <button onclick="enviroment.drawChart()" style="z-index:50" class="btn-popup reflected">â˜…</button>

      <!-- left simuli shown here -->
      <div id="status-bar">
        <div id="stimuli-counter">24</div>
      </div>

      <!-- a button to start/stop the game -->
      <button onclick="game.start()" id="engine-btn" class="btn-standard">Play</button>

      <!-- the N-back grid -->
      <table id="grid">
        <tbody>
          <tr>
            <td class="heading-td">
              <div class="tile hidden"></div>
            </td>
            <td class="heading-td">
              <div class="tile center-tile">
                <p id="N-level">N = 2</p>
              </div>
            </td>
          </tr>
          <tr><td class="visual-td"><div class="tile tile-left"></div></td><td class="visual-td"><div class="tile tile-right"></div></td></tr>
        </tbody>
      </table>

      <!-- buttons to confirm clues -->
      <div id="eye-left-btn"></div>
      <div id="eye-right-btn"></div>
      <div id="ear-left-btn"></div>
      <div id="ear-right-btn"></div>
    </div>
    <!-- training-field end -->

    <script src="js/main.js"></script>
    <script src="js/game.js"></script>
    <script>
      enviroment.init();
      game.init();
      
      // Reactive Settings Integration for Unified System
      window.settings = {
        nLevel: parseInt(document.getElementById('set-level').value),
        stimulusTime: parseInt(document.getElementById('set-time').value),
        matchingClues: parseInt(document.getElementById('set-clues').value),
        soundsLeft: document.getElementById('select-sound-left').value,
        soundsRight: document.getElementById('select-sound-right').value,
        feedback: parseInt(document.getElementById('feedback').value) === 1,
        dailyGoal: 20 // Default value
      };
      
      function updateSettings(newSettings) {
        console.log('ðŸŽ® [DICHOTIC-DUAL-NBACK] Updating settings:', newSettings);
        
        if (newSettings) {
          // Update settings object
          Object.assign(window.settings, newSettings);
        }
        
        // Apply settings to UI elements
        if (window.settings.nLevel !== undefined) {
          document.getElementById('set-level').value = window.settings.nLevel;
          document.getElementById('set-level-span').textContent = window.settings.nLevel;
          game.n = window.settings.nLevel;
        }
        
        if (window.settings.stimulusTime !== undefined) {
          document.getElementById('set-time').value = window.settings.stimulusTime;
          document.getElementById('set-time-span').textContent = window.settings.stimulusTime + 'ms';
          game.time = window.settings.stimulusTime;
        }
        
        if (window.settings.matchingClues !== undefined) {
          document.getElementById('set-clues').value = window.settings.matchingClues;
          document.getElementById('set-clues-span').textContent = window.settings.matchingClues;
          game.clues = window.settings.matchingClues;
        }
        
        if (window.settings.soundsLeft !== undefined) {
          document.getElementById('select-sound-left').value = window.settings.soundsLeft;
          game.soundsLeft = window.settings.soundsLeft;
        }
        
        if (window.settings.soundsRight !== undefined) {
          document.getElementById('select-sound-right').value = window.settings.soundsRight;
          game.soundsRight = window.settings.soundsRight;
        }
        
        if (window.settings.feedback !== undefined) {
          document.getElementById('feedback').value = window.settings.feedback ? 1 : 0;
          document.getElementById('feedback-span').textContent = window.settings.feedback ? 'on' : 'off';
          game.feedback = window.settings.feedback;
        }
        
        // Update N-level display
        document.getElementById('N-level').textContent = 'N = ' + window.settings.nLevel;
        
        console.log('ðŸŽ® [DICHOTIC-DUAL-NBACK] Settings updated successfully');
      }
      
      function repopulateGui() {
        // Update the settings object with current values
        window.settings.nLevel = parseInt(document.getElementById('set-level').value);
        window.settings.stimulusTime = parseInt(document.getElementById('set-time').value);
        window.settings.matchingClues = parseInt(document.getElementById('set-clues').value);
        window.settings.soundsLeft = document.getElementById('select-sound-left').value;
        window.settings.soundsRight = document.getElementById('select-sound-right').value;
        window.settings.feedback = parseInt(document.getElementById('feedback').value) === 1;
        
        console.log('ðŸŽ® [DICHOTIC-DUAL-NBACK] GUI repopulated with current settings');
      }
      
      function startGame() {
        console.log('ðŸŽ® [DICHOTIC-DUAL-NBACK] Starting game via unified system');
        game.start();
      }
      
      // Initialize settings object with current values
      updateSettings();
    </script>
  </body>

</html>
